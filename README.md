# Сравнение калькуляций

WPF‑приложение для Windows, которое сравнивает две Excel-калькуляции, группирует строки по продукции и показывает агрегированные изменения по каждой группе. Отчёт можно сохранить в отдельный Excel-файл для передачи заказчику.

## Основные возможности

- Выбор двух входных файлов через стандартные диалоги Windows и отображение путей в интерфейсе приложения.
- Таблица различий с колонками для старых и новых значений (количество, цена, сумма), рассчитанными дельтами и процентным изменением.
- Группировка позиций по продукции с автоматическим расчётом итогов; группы, в которых изменение суммы меньше 5 %, скрываются как несущественные.
- Формирование статуса для каждой строки (`Добавлено`, `Удалено`, `Изменено`, `Без изменений`) для наглядного анализа.
- Экспорт результирующей таблицы в новый Excel-файл c заголовками, разделителями по продукции, суммарными строками и автонастройкой ширины столбцов.
- Корректная обработка числовых значений, записанных с пробелами или в разных форматах (текущая культура, `ru-RU`, инвариантная).

## Требования

- Windows с установленным .NET SDK 8.0 (проект таргетирует `net8.0-windows`).
- Поддержка WPF (`UseWPF` включён в проект).
- Пакет ClosedXML подключается автоматически при выполнении `dotnet restore`.

## Установка и запуск

1. Восстановите зависимости:
   ```bash
   dotnet restore
2. Соберите решение:
   ```bash
   dotnet build Excel.sln
3. Запустите приложение:
   ```bash
   dotnet run --project Excel/Excel.csproj
Альтернативно можно открыть решение в Visual Studio или Rider и запустить его оттуда.


Статусы строк
Статус	      Описание
Добавлено	    Позиция встречается только во второй калькуляции.
Удалено	      Позиция присутствовала только в первой калькуляции.
Изменено	    Позиция есть в обеих калькуляциях, но числовые значения отличаются.
Без изменений	Позиция идентична в обоих файлах.


Особенности разбора Excel
Обрабатывается только первый лист рабочей книги.
Для выделения блоков продукции анализируются строки, содержащие слово «продукц». Если следующая ячейка непуста, её значение используется как название продукции.
В расчёт попадают первые три числовые колонки строки (количество, цена, сумма); повторяющиеся подписи строк получают добавочное «(2)», «(3)» и т. д.
Строки с подытогами («Итого», «в т.ч.») и заголовки с римскими числами и двоеточием отбрасываются из сравнения.
Для суммирования используются только строки, оставшиеся после фильтрации; групповой итог выводится, если изменение суммы превышает 5 % или абсолютная дельта отличается от нуля.

Структура проекта
Excel.sln — корневое решение.
Excel/Excel.csproj — WPF-проект приложения.
Excel/App.xaml, Excel/App.xaml.cs — точка входа.
Excel/MainWindow.xaml — разметка основного окна.
Excel/MainWindow.xaml.cs — логика сравнения, группировки и экспорта.
Excel/ProductSummary.cs, Excel/ProductSummaryConverter.cs — расчёт итогов по продукции и отображение в заголовках групп.
Excel/DecimalHelper.cs — вспомогательные методы работы с десятичными значениями.

